# éƒ¨ç½²æ£€æŸ¥æ¸…å• - What's In It API

## åç«¯ä»£ç ä¿®å¤æ€»ç»“

### 1. ğŸ”§ ä¿®å¤äº†APIè¯·æ±‚æ ¼å¼ä¸åŒ¹é…é—®é¢˜

**é—®é¢˜**: Analysis APIç«¯ç‚¹æœŸæœ›ä¸¤ä¸ªåˆ†ç¦»çš„Bodyå‚æ•°ï¼Œä½†å‰ç«¯å‘é€çš„æ˜¯å•ä¸€JSONå¯¹è±¡

**ä¿®å¤**:
- æ·»åŠ äº†æ–°çš„ `ComprehensiveAnalysisRequest` æ¨¡å‹åœ¨ `schemas/food.py`
- ä¿®æ”¹äº† `analysis.py` è·¯ç”±æ¥æ¥å—æ­£ç¡®çš„è¯·æ±‚æ ¼å¼
- æ›´æ–°äº†è¯·æ±‚å¤„ç†é€»è¾‘

### 2. ğŸ”§ ä¿®å¤äº†ç”¨æˆ·åå¥½å­—æ®µä¸åŒ¹é…é—®é¢˜

**é—®é¢˜**: å‰ç«¯(web)ä½¿ç”¨ `diet_types`ï¼ŒFlutterä½¿ç”¨ `diet_type`ï¼Œåç«¯åªæ”¯æŒ `diet_type`

**ä¿®å¤**:
- æ›´æ–°äº† `UserHealthProfile` æ¨¡å‹æ”¯æŒä¸¤ç§æ ¼å¼
- æ·»åŠ äº† `get_diet_types()` æ–¹æ³•æ¥å¤„ç†å…¼å®¹æ€§
- æ›´æ–°äº† Perplexity æœåŠ¡ä½¿ç”¨æ–°æ–¹æ³•

### 3. âœ… å¥åº·æ£€æŸ¥ç«¯ç‚¹
- æ·»åŠ äº† `/health` ç«¯ç‚¹ç”¨äºè´Ÿè½½å‡è¡¡å™¨
- æ”¹è¿›äº†æ ¹è·¯å¾„ `/` å“åº”

### 4. âœ… å¯åŠ¨è„šæœ¬
- åˆ›å»ºäº† `start.py` ç”¨äºç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

## éƒ¨ç½²è¦æ±‚

### ç¯å¢ƒå˜é‡
ç¡®ä¿è®¾ç½®ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼š
```
PERPLEXITY_API_KEY=your_api_key_here
PORT=8000 (å¯é€‰ï¼Œé»˜è®¤8000)
HOST=0.0.0.0 (å¯é€‰ï¼Œé»˜è®¤0.0.0.0)
```

### å¯åŠ¨å‘½ä»¤
```bash
# å¼€å‘ç¯å¢ƒ
python3 main.py

# ç”Ÿäº§ç¯å¢ƒ
python3 start.py

# æˆ–ä½¿ç”¨uvicorn
uvicorn main:app --host 0.0.0.0 --port 8000
```

### APIç«¯ç‚¹æµ‹è¯•

#### 1. å¥åº·æ£€æŸ¥
```bash
curl https://api.whats-in-it.org/health
# æœŸæœ›å“åº”: {"status": "healthy", "service": "What's In It API"}
```

#### 2. äº§å“æŸ¥è¯¢
```bash
curl https://api.whats-in-it.org/api/v1/product/3168930007197
# æœŸæœ›å“åº”: äº§å“ä¿¡æ¯JSON
```

#### 3. åˆ†æAPI (Webæ ¼å¼)
```bash
curl -X POST https://api.whats-in-it.org/api/v1/analyze-comprehensive \
  -H "Content-Type: application/json" \
  -d '{
    "product": {
      "barcode": "3168930007197",
      "name": "Test Product",
      "ingredients_text": "flour, sugar, salt"
    },
    "user_preferences": {
      "diet_types": ["vegetarian"],
      "allergies": ["nuts"],
      "health_conditions": []
    }
  }'
```

## å¸¸è§502é”™è¯¯åŸå› 

1. **åº”ç”¨æœªå¯åŠ¨**: ç¡®ä¿FastAPIåº”ç”¨æ­£åœ¨è¿è¡Œ
2. **ç«¯å£é”™è¯¯**: ç¡®ä¿åº”ç”¨ç›‘å¬æ­£ç¡®ç«¯å£
3. **ä¸»æœºç»‘å®š**: ç¡®ä¿ç»‘å®šåˆ° `0.0.0.0` è€Œä¸æ˜¯ `127.0.0.1`
4. **ä¾èµ–ç¼ºå¤±**: è¿è¡Œ `pip install -r requirements.txt`
5. **ç¯å¢ƒå˜é‡**: ç¡®ä¿ `PERPLEXITY_API_KEY` å·²è®¾ç½®
6. **ä»£ç†é…ç½®**: æ£€æŸ¥åå‘ä»£ç†(å¦‚nginx)é…ç½®

## æµ‹è¯•æ­¥éª¤

1. âœ… ä¾èµ–å®‰è£…æˆåŠŸ
2. âœ… FastAPIåº”ç”¨å¯ä»¥å¯¼å…¥
3. â³ éœ€è¦æµ‹è¯•å®é™…HTTPæœåŠ¡å™¨å¯åŠ¨
4. â³ éœ€è¦æµ‹è¯•APIç«¯ç‚¹å“åº”
5. â³ éœ€è¦éªŒè¯CORSè®¾ç½®
6. â³ éœ€è¦æµ‹è¯•å‰ç«¯è¿æ¥

## ä¸‹ä¸€æ­¥

1. å¯åŠ¨æœåŠ¡å™¨: `python3 start.py`
2. æµ‹è¯•å¥åº·æ£€æŸ¥ç«¯ç‚¹
3. æµ‹è¯•äº§å“API
4. æµ‹è¯•åˆ†æAPI
5. éªŒè¯å‰ç«¯è¿æ¥